parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"D94y":[function(require,module,exports) {

},{}],"Pqf4":[function(require,module,exports) {
"use strict";function e(e,r){return o(e)||i(e,r)||n(e,r)||t()}function t(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function n(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function i(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,o=void 0;try{for(var l,s=e[Symbol.iterator]();!(r=(l=s.next()).done)&&(n.push(l.value),!t||n.length!==t);r=!0);}catch(a){i=!0,o=a}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}function o(e){if(Array.isArray(e))return e}require("../styles/editCal.scss");var l,s,a,d=firebase.storage(),c=firebase.database(),u=Date.now(),m=!1,b=null,g=null,h=null,f=["sun","mon","tue","wed","thu","fri","sat"],E=["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sabado"];function p(e){switch(e){case 1:return"Enero";case 2:return"Febrero";case 3:return"Marzo";case 4:return"Abril";case 5:return"Mayo";case 6:return"Junio";case 7:return"Julio";case 8:return"Agosto";case 9:return"Septiembre";case 10:return"Octubre";case 11:return"Noviembre";case 12:case 0:return"Diciembre";case 13:return"Enero"}}function v(){return console.log("Saving..."),db.collection("calendarios").doc(s).update(l)}function y(){v().then(function(){h&&C(),m&&clearInterval(a),m=!0,a=setInterval(function(){var e=Math.floor((Date.now()-u)/6e4);document.getElementById("tagLstSave").innerText=e<60?"Guardado hace "+e+" minutos":"Guardado hace "+Math.floor(e/60)+" horas"},300010),document.getElementById("tagLstSave").innerText="Se han guardado los cambios",u=Date.now()}).catch(function(e){document.getElementById("tagLstSave").innerText="Error, no se han guardado todos los cambios: "+e.code,console.log(e)})}function I(e,t){e.setAttribute("aria-valuenow",t),e.style.width=t+"%",e.innerText=t+"%"}function C(){Object.keys(l.events).forEach(function(e){hideEl(document.getElementById(e))}),document.getElementById("mdlEventInfoL").innerHTML=l.events[h].date,showEl(document.getElementById(h)),enable(document.getElementById("btnPriorEve")),enable(document.getElementById("btnNextEve"))}function B(){document.getElementById("weeksCont").innerHTML="",l.weeks.forEach(function(e,t){var n=document.createElement("tr");n.style.height="10rem",document.getElementById("weeksCont").appendChild(n);for(var r=function(r){var i=e[f[r]],o=document.createElement("td");if(classes(o,"p-0"),n.appendChild(o),i){var a=document.createElement("p");classes(a,"m-0 p-1"),a.style.fontSize="x-large",a.innerHTML="<b>"+i.date+"</b>",o.appendChild(a);var d=document.createElement("div");classes(d,"autoOverflow"),d.style.maxHeight="7rem",i.events.forEach(function(e,n){var i=document.createElement("button");i.setAttribute("data-toggle","modal"),i.setAttribute("data-target","#mdlEventInfo"),classes(i,"btn text-left p-1 mb-1 w-100"),i.style.backgroundColor="#c3e6cb",i.style.borderColor="#8fd19e",i.innerHTML="<small>"+e.name+"</small>",i.onclick=function(){h=t+f[r]+n,C()},d.appendChild(i)});var c=document.createElement("button");classes(c,"btn btn-scckie btn-block btn-sm"),c.innerHTML='<i class="fas fa-plus"></i>',c.onclick=function(){l.events[t+f[r]+i.events.length]={date:E[r]+" "+i.date+" de "+p(s%100),name:"Evento sin nombre",description:"Sin descripción",visibilidad:"Visible a simple vista",horario:["Ciudad de México:","Bogotá:","Madrid:"]},i.events.push({name:"Evento sin nombre"}),y()},d.appendChild(c),o.appendChild(d)}},i=0;i<7;i++)r(i)}),document.getElementById("eventInfoCont").innerHTML="";for(var t=function(){var t=e(r[n],2),i=t[0],o=t[1],s=!1,a=document.createElement("div");a.id=i,classes(a,"d-none overflow-auto");var d=document.createElement("div");classes(d,"modal-body"),a.appendChild(d);var c=document.createElement("div");classes(c,"d-none"),d.appendChild(c);var u=document.createElement("div");classes(u,"form-group"),c.appendChild(u),u.innerHTML="<label>Nombre del evento</label>";var m=document.createElement("input");m.id="inEveTitle"+i,m.setAttribute("type","text"),classes(m,"form-control"),u.appendChild(m);var b=document.createElement("div");classes(b,"form-group"),c.appendChild(b),b.innerHTML="<label>Descripción</label>";var g=document.createElement("textarea");classes(g,"form-control"),g.id="inEveDesc"+i,g.setAttribute("rows","3"),b.appendChild(g);var f=document.createElement("div");classes(f,"form-group"),c.appendChild(f),f.innerHTML="<label>Visiblidad</label>";var E=document.createElement("select");E.id="inVis"+i,classes(E,"form-control");var p=["Visible a simple vista","Visible con binoculares","Visible con un telescopio pequeño","Visible con un telescopio de 4 pulgadas","Visible con un telescopio grande","No observable"];p.forEach(function(e,t){var n=document.createElement("option");n.value=t,n.innerHTML=e,e==o.visibilidad&&n.setAttribute("selected","true"),E.appendChild(n)}),f.appendChild(E);var v=document.createElement("div");classes(v,"form-group"),c.appendChild(v),v.innerHTML="<label>Horario</label>";var I=document.createElement("textarea");classes(I,"form-control"),I.id="inTime"+i,I.setAttribute("rows","4"),v.appendChild(I),5==E.value?hideEl(v):showEl(v),m.oninput=function(){enable(H),s=!0},g.oninput=function(){enable(H),s=!0},E.oninput=function(){enable(H),s=!0,5==E.value?hideEl(v):showEl(v)},I.oninput=function(){enable(H),s=!0};var C=document.createElement("div");d.appendChild(C);var B=document.createElement("h3");B.innerHTML=o.name,C.appendChild(B);var w=document.createElement("p");w.innerHTML=o.description,C.appendChild(w);var M=document.createElement("p");M.innerHTML="Visibilidad: "+o.visibilidad,C.appendChild(M);var T=document.createElement("p");classes(T,"mb-0"),T.innerHTML="Horario: ",C.appendChild(T);var A=document.createElement("ul");C.appendChild(A),o.horario.forEach(function(e){var t=document.createElement("li");t.innerHTML=e,A.appendChild(t)}),"No observable"==o.visibilidad?(hideEl(T),hideEl(A)):(showEl(T),showEl(A));var S=document.createElement("div");classes(S,"modal-footer"),a.appendChild(S);var L=document.createElement("button");classes(L,"btn btn-danger mr-auto"),L.setAttribute("type","button"),L.innerText="Borrar",L.onclick=function(){for(var e=Number(i.substr(4))+1;e<l.weeks[Number(i[0])][i.substr(1,3)].events.length;e++)l.events[i.substr(0,4)+(e-1)]=l.events[i.substr(0,4)+e];delete l.events[i.substr(0,4)+(l.weeks[Number(i[0])][i.substr(1,3)].events.length-1)],l.weeks[Number(i[0])][i.substr(1,3)].events.splice(Number(i.substr(4)),1),$("#mdlEventInfo").modal("hide"),h=null,y()},S.appendChild(L);var k=document.createElement("button");classes(k,"btn btn-info"),k.setAttribute("type","button"),k.innerText="Editar",k.onclick=function(){m.value=o.name,g.innerHTML=o.description,E.value=p.indexOf(o.visibilidad),5==E.value?hideEl(v):showEl(v),I.innerHTML="",o.horario.forEach(function(e){I.innerHTML+=e+"\n"}),hideEl(C),showEl(c),showEl(H),showEl(x),enable(x),hideEl(k)},S.appendChild(k);var H=document.createElement("button");classes(H,"btn btn-secondary mr-1 d-none"),H.setAttribute("type","button"),disable(H),H.innerText="Revertir",H.onclick=function(){s=!1,disable(H),m.value=o.name,g.innerHTML=o.description,E.value=p.indexOf(o.visibilidad),5==E.value?hideEl(v):showEl(v),I.innerHTML="",o.horario.forEach(function(e){I.innerHTML+=e.trim()+"\n"})},S.appendChild(H);var x=document.createElement("button");classes(x,"btn btn-scckie d-none"),x.setAttribute("type","button"),disable(x),x.innerText="Guardar",x.onclick=function(){disable(H),disable(x),s?(l.weeks[Number(i[0])][i.substr(1,3)].events[i[4]].name=o.name=m.value,o.description=g.value.trim(),o.visibilidad=p[E.value],o.horario=[],I.value.trim().split("\n").forEach(function(e){""!=e&&" "!=e&&o.horario.push(e)}),y()):(hideEl(c),showEl(C),hideEl(H),hideEl(x),showEl(k))},S.appendChild(x),document.getElementById("eventInfoCont").appendChild(a)},n=0,r=Object.entries(l.events);n<r.length;n++)t()}function w(e){document.getElementById("prevMed").src=l.picUrl,e&&(document.getElementById("inMedSrc0").checked=!1,document.getElementById("inMedSrc1").checked=!1),document.getElementById("inChgImg").value="",document.getElementById("inChgImgUrl").value="",document.getElementById("inChgImg").removeAttribute("required"),document.getElementById("inChgImgUrl").removeAttribute("required"),hideEl(document.getElementById("barChgImgCont")),hideEl(document.getElementById("inChgImgFileCont")),hideEl(document.getElementById("inChgImgUrlCont")),document.getElementById("btnCnfChgImg").removeAttribute("disabled"),document.getElementById("btnCanChgImg").removeAttribute("disabled")}function M(){var e;c.ref("nextCal").transaction(function(t){return t&&(e=t,++t%100==13&&(t-=12,t+=100)),t},function(t){if(t)console.log(t);else{var n,r=p(e%100),i=new Date((e-e%100)/100+" "+e%100+" 00:00"),o=[];n=1==i.getMonth()?i.getFullYear()%4==0?29:28:i.getMonth()%2==0?i.getMonth()<=6?31:30:i.getMonth()<=6?30:31;for(var l=i.getDay(),s=1;s<=n;s=s){for(var a={},d=l;d<f.length&&!(s>n);d++)a[f[d]]={date:s,events:[]},s++;o.push(a),l=0}var c=(e-e%100)/100,u=(e-e%100)/100;e%100==12&&c++,e%100==1&&u--;var m=p(e%100+1).toLowerCase(),b=p(e%100-1).toLowerCase();db.collection("calendarios").doc(Math.abs(e).toString()).set({events:{},date:firebase.firestore.Timestamp.fromDate(i),description:"Sin descripción",descriptionShort:"Sin descripción",finished:!1,pastDue:!1,picUrl:"",picAlt:"",picCapt:"",public:!1,sentMail:!1,revised:[],title:"Calendario Astronómico de "+r+" "+(e-e%100)/100,url:"https://sciencecookies.net/calendario-astronomico/"+(e-e%100)/100+"/"+r.toLowerCase(),nextCal:"https://sciencecookies.net/calendario-astronomico/"+c+"/"+m,priorCal:"https://sciencecookies.net/calendario-astronomico/"+u+"/"+b,weeks:o}).then(function(){console.log("nuevo calendario")}).catch(function(e){return console.log(e)})}})}window.loaded=function(){db.collection("calendarios").doc(urlSrch.get("file")).onSnapshot(function(e){e.exists?(l=e.data(),s=e.id,document.getElementById("title").innerHTML=l.title,document.getElementById("prevMed").src=l.picUrl,document.getElementById("inPicCapt").value=l.picCapt,document.getElementById("inPicAlt").value=l.picAlt,document.getElementById("inDesc").value=l.description,document.getElementById("inDescShort").value=l.descriptionShort,B(),l.public?(hideEl(document.getElementById("btnAprove")),hideEl(document.getElementById("btnPub"))):(showEl(document.getElementById("btnAprove")),l.pastDue&&showEl(document.getElementById("btnPub"))),l.revised.includes(uid)?document.getElementById("btnAprove").innerHTML='<i class="fas fa-check-square"></i>':document.getElementById("btnAprove").innerHTML='<i class="far fa-check-square"></i>',document.getElementById("btnSrcCal").href="https://in-the-sky.org/newscal.php?month=".concat(urlSrch.get("file").substr(5,6),"&year=").concat(urlSrch.get("file").substr(0,4),"&maxdiff=7&country=1484&reg1=3527646&reg2=8379372&town=3530597")):window.location.href="../404"},function(e){return console.log(e)}),document.getElementById("frmText").addEventListener("submit",function(e){e.preventDefault(),l.description=document.getElementById("inDesc").value.trim(),l.descriptionShort=document.getElementById("inDescShort").value.trim(),y()}),document.getElementById("frmChgImg").addEventListener("submit",function(e){var t;e.preventDefault(),I(document.getElementById("barChgImg"),"0"),showEl(document.getElementById("barChgImgCont")),hideEl(document.getElementById("frmChgImg")),document.getElementById("btnCnfChgImg").setAttribute("disabled","true"),document.getElementById("btnCanChgImg").setAttribute("disabled","true"),"home"==g?(t=d.ref("calendarMedia/"+s+"/pic")).put(b).on("state_changed",function(e){I(document.getElementById("barChgImg"),Math.floor(e.bytesTransferred/e.totalBytes*100))},function(e){document.getElementById("alrtClsSsn").innerHTML='<div id="alrtClsSsnAlrt" class="alert alert-warning alert-dismissible fade show fixed-bottom" role="alert"><strong>¡Ocurrió un error!</strong> '+e.code+'<button id="btnAlrtClsSsn" type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>',setTimeout(function(){document.getElementById("btnAlrtClsSsn")&&document.getElementById("btnAlrtClsSsn").click()},3e3),console.log(e),$("#mdlAddMed").modal("hide")},function(){t.getDownloadURL().then(function(e){l.picUrl=e,y(),w(!0),hideEl(document.getElementById("frmChgImg"))}).catch(function(e){console.log(e)})}):(l.picUrl=document.getElementById("inChgImgUrl").value,y(),w(!0),hideEl(document.getElementById("frmChgImg")))})},document.getElementById("inPicCapt").oninput=function(){l.picCapt=document.getElementById("inPicCapt").value.trim()},document.getElementById("inPicAlt").oninput=function(){l.picAlt=document.getElementById("inPicAlt").value.trim()},document.getElementById("inDesc").oninput=function(){l.picDesc=document.getElementById("inDesc").value.trim()},document.getElementById("inDescShort").oninput=function(){l.picDescShort=document.getElementById("inDescShort").value.trim()},document.getElementById("btnPriorEve").onclick=function(){var e=Object.keys(l.events).slice().sort(function(e,t){if(Number(e[0])==Number(t[0])){if(e.substring(1,4)==t.substring(1,4))return Number(e[4])-Number(t[4]);switch(e.substring(1,4)){case"sun":return-1;case"mon":return"sun"==t.substring(1,4)?1:-1;case"tue":return"sun"==t.substring(1,4)||"mon"==t.substring(1,4)?1:-1;case"wed":return"sun"==t.substring(1,4)||"mon"==t.substring(1,4)||"tue"==t.substring(1,4)?1:-1;case"thu":return"sun"==t.substring(1,4)||"mon"==t.substring(1,4)||"tue"==t.substring(1,4)||"wed"==t.substring(1,4)?1:-1;case"fri":return"sun"==t.substring(1,4)||"mon"==t.substring(1,4)||"tue"==t.substring(1,4)||"wed"==t.substring(1,4)||"thu"==t.substring(1,4)?1:-1;case"sat":return 1}}return Number(e[0])-Number(t[0])}),t=e.indexOf(h)-1;t>=0?(h=e[t],C()):disable(document.getElementById("btnPriorEve"))},document.getElementById("btnNextEve").onclick=function(){var e=Object.keys(l.events).slice().sort(function(e,t){if(Number(e[0])==Number(t[0])){if(e.substring(1,4)==t.substring(1,4))return Number(e[4])-Number(t[4]);switch(e.substring(1,4)){case"sun":return-1;case"mon":return"sun"==t.substring(1,4)?1:-1;case"tue":return"sun"==t.substring(1,4)||"mon"==t.substring(1,4)?1:-1;case"wed":return"sun"==t.substring(1,4)||"mon"==t.substring(1,4)||"tue"==t.substring(1,4)?1:-1;case"thu":return"sun"==t.substring(1,4)||"mon"==t.substring(1,4)||"tue"==t.substring(1,4)||"wed"==t.substring(1,4)?1:-1;case"fri":return"sun"==t.substring(1,4)||"mon"==t.substring(1,4)||"tue"==t.substring(1,4)||"wed"==t.substring(1,4)||"thu"==t.substring(1,4)?1:-1;case"sat":return 1}}return Number(e[0])-Number(t[0])}),t=e.indexOf(h)+1;t<e.length?(h=e[t],C()):disable(document.getElementById("btnNextEve"))},document.getElementById("btnChgImg").onclick=function(){w(!0),toggleEl(document.getElementById("frmChgImg"))},document.getElementById("inChgImg").addEventListener("change",function(e){var t;(b=e.target.files[0]).name=ultraClean(b.name,""),document.getElementById("inChgImgL").innerHTML=b.name,(t=new FileReader).readAsDataURL(b),t.onload=function(e){document.getElementById("prevMed").src=e.target.result}}),document.getElementById("inChgImgUrl").onchange=function(){document.getElementById("prevMed").src=document.getElementById("inChgImgUrl").value},document.getElementById("inMedSrc0").onclick=function(){g="home",w(!1),document.getElementById("inChgImg").setAttribute("required","true"),showEl(document.getElementById("inChgImgFileCont"))},document.getElementById("inMedSrc1").onclick=function(){g="out",w(!1),document.getElementById("inChgImgUrl").setAttribute("required","true"),showEl(document.getElementById("inChgImgUrlCont"))},document.getElementById("btnPrevCal").onclick=function(){l.timePrev=new firebase.firestore.Timestamp.fromMillis(new Date(Date.now()).getTime()+9e5),v().then(function(){window.open(l.url,"_blank").focus()}).catch(function(e){return console.log(e)})},document.getElementById("btnPrevMail").onclick=function(){l.timePrev=new firebase.firestore.Timestamp.fromMillis(new Date(Date.now()).getTime()+9e5),v().then(function(){window.open("vista-email-calendario/"+s,"_blank").focus()}).catch(function(e){return console.log(e)})},document.getElementById("btnAprove").onclick=function(){l.revised.includes(uid)?(l.revised.splice(l.revised.indexOf(uid),1),l.finished=!1,document.getElementById("btnAprove").innerHTML='<i class="far fa-check-square"></i>'):(l.revised.push(uid),document.getElementById("btnAprove").innerHTML='<i class="fas fa-check-square"></i>',l.revised.length>1&&(l.finished=!0,M())),y()},$("#mdlPublish").on("show.bs.modal",function(e){var t=l.revised.length;l.revised.includes(uid)||t++,t<2?(hideEl(document.getElementById("btnCnfPublish")),document.getElementById("mdlPublishTxt").innerText="Para publicar es necesario que lo hayan aprovado al menos dos personas."):(showEl(document.getElementById("btnCnfPublish")),document.getElementById("mdlPublishTxt").innerText="El calendario está listo para publicar")}),document.getElementById("btnCnfPublish").onclick=function(){l.public||(I(document.getElementById("barPublish"),"0"),showEl(document.getElementById("barPublishCont")),I(document.getElementById("barPublish"),"25"),db.collection("calendarios").doc(s).update({public:!0}).then(function(){I(document.getElementById("barPublish"),"63"),admin.database().ref("calendarios/"+calID).set({pop:0},function(e){if(!e)return I(document.getElementById("barPublish"),"100"),classes(document.getElementById("barPublish"),"bg-success"),document.getElementById("alrtClsSsn").innerHTML='<div id="alrtClsSsnAlrt" class="alert alert-success alert-dismissible fade show fixed-bottom" role="alert">Publicado correctamente<strong></strong>                                                                           <button id="btnAlrtClsSsn" type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>',setTimeout(function(){window.open(l.url,"_blank").focus()},2500),console.log("Published successfully."),setTimeout(function(){document.getElementById("btnAlrtClsSsn").click()},3e3),$("#alrtClsSsnAlrt").on("closed.bs.alert",function(){document.getElementById("alrtClsSsn").innerHTML=""}),$("#mdlPublish").modal("hide"),console.log("Published "+calID+" calendar"),null;document.getElementById("alrtClsSsn").innerHTML='<div id="alrtClsSsnAlrt" class="alert alert-danger alert-dismissible fade show fixed-bottom" role="alert"><strong>!Ha ocurrido un error! </strong>'+e+'<button id="btnAlrtClsSsn" type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>',console.log(e),setTimeout(function(){document.getElementById("btnAlrtClsSsn").click()},3e3),$("#alrtClsSsnAlrt").on("closed.bs.alert",function(){document.getElementById("alrtClsSsn").innerHTML=""})})}).catch(function(e){document.getElementById("alrtClsSsn").innerHTML='<div id="alrtClsSsnAlrt" class="alert alert-danger alert-dismissible fade show fixed-bottom" role="alert"><strong>!Ha ocurrido un error! </strong>'+e+'<button id="btnAlrtClsSsn" type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>',console.log(e),setTimeout(function(){document.getElementById("btnAlrtClsSsn").click()},3e3),$("#alrtClsSsnAlrt").on("closed.bs.alert",function(){document.getElementById("alrtClsSsn").innerHTML=""})}))};
},{"../styles/editCal.scss":"D94y"}]},{},["Pqf4"], null)
//# sourceMappingURL=/editCal.55b665a9.js.map
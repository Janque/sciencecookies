{"version":3,"sources":["js/editCal.js"],"names":["store","firebase","storage","rtDb","database","docDat","docId","docRef","lastSave","Date","now","saved","newMedia","newMedSrc","eventToShow","daysOfWeek","longDay","fullMonth","n","l","savedInterval","saveDoc","console","log","promises","Promise","langs","forEach","lang","syncUpt","published","finished","pastDue","public","sentMail","revised","translations","url","push","db","collection","doc","update","all","then","normSave","showEvent","clearInterval","setInterval","minutes","Math","floor","document","getElementById","innerText","catch","err","code","setprog","bar","setAttribute","style","width","Object","keys","events","key","hideEl","innerHTML","date","showEl","enable","render","weeks","week","wIdx","weekRow","createElement","height","appendChild","i","day","dayCell","classes","num","fontSize","maxHeight","event","idx","btnEvent","backgroundColor","borderColor","name","onclick","btnPlusEvent","length","description","visibilidad","horario","entries","changed","form","id","bod","fsec","fg0","in0","fg1","in1","fg2","in2","visOpts","itm","opt","value","fg3","in3","oninput","reverBtn","selLangCC","selLangC","selLang","btnTrans","get","sect","data","type","cont","title","translateSimple","html","text","titleTxt","alt","caption","tsec","eveTit","eveDesc","eveVis","eveTime","eveTimeLst","time","li","foot","delBtn","Number","substr","splice","$","modal","editBtn","indexOf","saveBtn","disable","trim","split","getElementsByName","cloneNode","resetChgImg","uncheck","src","picUrl","checked","removeAttribute","validateRevision","revLangs","rev","includes","uid","newCal","nextCalID","ref","transaction","nCal","error","days","getMonth","getFullYear","bDay","getDay","j","newC","firestore","Timestamp","fromDate","descriptionShort","picAlt","picCapt","nextCal","priorCal","intId","parseInt","year","nYear","pYear","month","nMonth","toLowerCase","pMonth","calsText","abs","toString","set","window","loaded","descFrm","calendarsFSRef","urlSrch","onSnapshot","exists","href","location","addEventListener","preventDefault","ori","addMed","put","on","snap","bytesTransferred","totalBytes","alertTop","getDownloadURL","medUrl","picDesc","picDescShort","orderedKeys","slice","sort","a","b","substring","toggleEl","e","target","files","ultraClean","prevMed","read","FileReader","readAsDataURL","onload","e2","result","onchange","timePrev","fromMillis","getTime","admin","pop","setTimeout","open","focus"],"mappings":"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","file":"editCal.e72f9c54.js","sourceRoot":"../src","sourcesContent":["import '../styles/editCal.scss';\n\nvar store = firebase.storage();\nvar rtDb = firebase.database();\n\nlet docDat, docId, docRef;\nlet lastSave = Date.now(), saved = false;\n\nlet newMedia = null;\nlet newMedSrc = null;\n\nlet eventToShow = null;\n\nconst daysOfWeek = ['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat'], longDay = ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sabado'];\nfunction fullMonth(n, l) {\n    if (l == \"es\") {\n        switch (n) {\n            case 1:\n                return \"Enero\";\n            case 2:\n                return \"Febrero\";\n            case 3:\n                return \"Marzo\";\n            case 4:\n                return \"Abril\";\n            case 5:\n                return \"Mayo\";\n            case 6:\n                return \"Junio\";\n            case 7:\n                return \"Julio\";\n            case 8:\n                return \"Agosto\";\n            case 9:\n                return \"Septiembre\";\n            case 10:\n                return \"Octubre\";\n            case 11:\n                return \"Noviembre\";\n            case 12:\n                return \"Diciembre\";\n            case 0:\n                return \"Diciembre\";\n            case 13:\n                return \"Enero\";\n        }\n    } else if (l == \"en\") {\n        switch (n) {\n            case 1:\n                return \"January\";\n            case 2:\n                return \"February\";\n            case 3:\n                return \"March\";\n            case 4:\n                return \"April\";\n            case 5:\n                return \"May\";\n            case 6:\n                return \"June\";\n            case 7:\n                return \"July\";\n            case 8:\n                return \"August\";\n            case 9:\n                return \"September\";\n            case 10:\n                return \"October\";\n            case 11:\n                return \"November\";\n            case 12:\n                return \"December\";\n            case 0:\n                return \"December\";\n            case 13:\n                return \"January\";\n        }\n    }\n}\n\nwindow.loaded = function loaded() {\n    docRef = calendarsFSRef.doc(urlSrch.get('id'));\n    calendarsFSRef.doc(urlSrch.get('id')).onSnapshot(doc => {\n        if (!doc.exists) {\n            window.location.href = '../404';\n            return;\n        }\n        docDat = doc.data();\n        docId = doc.id;\n        document.getElementById('title').innerHTML = docDat.title;\n        document.getElementById('prevMed').src = docDat.picUrl;\n        document.getElementById('inPicCapt').value = docDat.picCapt;\n        document.getElementById('inPicAlt').value = docDat.picAlt;\n        document.getElementById('inDesc').value = docDat.description;\n        document.getElementById('inDescShort').value = docDat.descriptionShort;\n        render();\n        if (docDat.public) {\n            hideEl(document.getElementById('btnAprove'));\n            hideEl(document.getElementById('btnPub'));\n        } else {\n            showEl(document.getElementById('btnAprove'));\n            if (docDat.pastDue) showEl(document.getElementById('btnPub'));\n        }\n        if (docDat.revised.includes(uid)) {\n            document.getElementById('btnAprove').innerHTML = '<i class=\"fas fa-check-square\"></i>';\n        } else {\n            document.getElementById('btnAprove').innerHTML = '<i class=\"far fa-check-square\"></i>';\n        }\n        document.getElementById('btnPrevCal').href = docDat.url;\n        document.getElementById('btnPrevMail').href = '/vista-email-calendario/' + docId;\n        document.getElementById('btnSrcCal').href = `https://in-the-sky.org/newscal.php?month=${urlSrch.get('id').substr(5, 6)}&year=${urlSrch.get('id').substr(0, 4)}&maxdiff=7&country=1484&reg1=3527646&reg2=8379372&town=3530597`;\n        document.getElementById('btnSrcCal2').href = `https://in-the-sky.org/newscal.php?month=${urlSrch.get('id').substr(5, 6)}&year=${urlSrch.get('id').substr(0, 4)}&maxdiff=7&country=1170&reg1=3688685&reg2=9609540&town=3688689`;\n        document.getElementById('btnSrcCal3').href = `https://in-the-sky.org/newscal.php?month=${urlSrch.get('id').substr(5, 6)}&year=${urlSrch.get('id').substr(0, 4)}&maxdiff=7&country=1724&reg1=3117732&reg2=6355233&town=3117735`;\n    }, err => console.log(err))\n\n    function descFrm() {\n        docDat.description = document.getElementById('inDesc').value.trim();\n        docDat.descriptionShort = document.getElementById('inDescShort').value.trim();\n        normSave();\n    }\n    document.getElementById(\"frmText\").addEventListener(\"submit\", function (event) {\n        event.preventDefault();\n        descFrm();\n    });\n    document.getElementById('btnFileTrans').onclick = function () {\n        let ori = document.getElementById('selFileTrans').value\n        db.collection('calendars/langs/' + ori).doc(docId).get().then(async function (doc) {\n            docDat.picCapt = document.getElementById('inPicCapt').value = await translateSimple(doc.data().picCapt, ori, lang);\n            docDat.picAlt = document.getElementById('inPicAlt').value = await translateSimple(doc.data().picAlt, ori, lang);\n            docDat.description = document.getElementById('inDesc').value = await translateSimple(doc.data().description, ori, lang);\n            docDat.descriptionShort = document.getElementById('inDescShort').value = await translateSimple(doc.data().descriptionShort, ori, lang);\n            descFrm();\n        }).catch(err => console.log(err));\n    }\n\n    function addMed() {\n        let ref = store.ref('calendarMedia/' + docId + '/pic');\n        ref.put(newMedia).on('state_changed',\n            function progress(snap) {\n                setprog(document.getElementById('barChgImg'), (snap.bytesTransferred / snap.totalBytes) * 100);\n            },\n            function error(err) {\n                if (lang = \"es\") {\n                    alertTop(\"<strong>¡Ha ocurrido un error!</strong> \" + err.code, 0);\n                } else if (lang = \"en\") {\n                    alertTop(\"<strong>¡There has been an error!</strong> \" + err.code, 0);\n                }\n                console.log(err);\n                $('#mdlAddMed').modal('hide');\n            },\n            function complete() {\n                ref.getDownloadURL().then(medUrl => {\n                    docDat.picUrl = medUrl;\n                    normSave();\n                    resetChgImg(true);\n                    hideEl(document.getElementById(\"frmChgImg\"));\n                }).catch(err => { console.log(err) });\n            }\n        );\n    }\n    function addExtMed() {\n        docDat.picUrl = document.getElementById('inChgImgUrl').value;\n        normSave();\n        resetChgImg(true);\n        hideEl(document.getElementById(\"frmChgImg\"));\n    }\n    document.getElementById(\"frmChgImg\").addEventListener(\"submit\", function (event) {\n        event.preventDefault();\n        setprog(document.getElementById('barChgImg'), 0);\n        showEl(document.getElementById(\"barChgImgCont\"));\n        hideEl(document.getElementById(\"frmChgImg\"));\n        document.getElementById(\"btnCnfChgImg\").setAttribute('disabled', 'true');\n        document.getElementById(\"btnCanChgImg\").setAttribute('disabled', 'true');\n        if (newMedSrc == \"home\") addMed();\n        else addExtMed();\n    });\n}\n\ndocument.getElementById('inPicCapt').oninput = () => {\n    docDat.picCapt = document.getElementById('inPicCapt').value.trim();\n}\ndocument.getElementById('inPicAlt').oninput = () => {\n    docDat.picAlt = document.getElementById('inPicAlt').value.trim();\n}\ndocument.getElementById('inDesc').oninput = () => {\n    docDat.picDesc = document.getElementById('inDesc').value.trim();\n}\ndocument.getElementById('inDescShort').oninput = () => {\n    docDat.picDescShort = document.getElementById('inDescShort').value.trim();\n}\n\nlet savedInterval;\nfunction saveDoc() {\n    console.log('Saving...');\n\n    const promises = [];\n    langs.forEach(l => {\n        if (l != lang) {\n            let syncUpt = {\n                published: docDat.published,\n                finished: docDat.finished,\n                pastDue: docDat.pastDue,\n                public: docDat.public,\n                sentMail: docDat.sentMail,\n                revised: docDat.revised,\n                translations: docDat.translations,\n            }\n            syncUpt.translations[lang] = docDat.url;\n            promises.push(db.collection('calendars/langs/' + l).doc(docId).update(syncUpt));\n        }\n    })\n    return Promise.all(promises).then(() => {\n        return docRef.update(docDat);\n    });\n}\nfunction normSave() {\n    saveDoc().then(() => {\n        if (eventToShow) showEvent();//IMPORTANT\n        if (saved) clearInterval(savedInterval);\n        saved = true;\n        savedInterval = setInterval(() => {\n            let minutes = Math.floor((Date.now() - lastSave) / 60000);\n            if (minutes < 60) document.getElementById('tagLstSave').innerText = \"Guardado hace \" + minutes + \" minutos\";\n            else document.getElementById('tagLstSave').innerText = \"Guardado hace \" + Math.floor(minutes / 60) + \" horas\";\n        }, 300010);\n        document.getElementById('tagLstSave').innerText = \"Se han guardado los cambios\";\n        lastSave = Date.now();\n        console.log('Saved!');\n    }).catch(err => {\n        document.getElementById('tagLstSave').innerText = \"Error, no se han guardado todos los cambios: \" + err.code;\n        console.log(err);\n    });\n}\n\nfunction setprog(bar, n) {\n    n = Math.floor(n);\n    bar.setAttribute('aria-valuenow', n);\n    bar.style.width = n + '%';\n    bar.innerText = n + '%';\n}\n\nfunction showEvent() {\n    Object.keys(docDat.events).forEach(key => {\n        hideEl(document.getElementById(key));\n    });\n    document.getElementById('mdlEventInfoL').innerHTML = docDat.events[eventToShow].date;\n    showEl(document.getElementById(eventToShow));\n    enable(document.getElementById('btnPriorEve'));\n    enable(document.getElementById('btnNextEve'));\n}\ndocument.getElementById('btnPriorEve').onclick = () => {\n    let orderedKeys = Object.keys(docDat.events).slice().sort((a, b) => {\n        if (Number(a[0]) == Number(b[0])) {\n            if (a.substring(1, 4) == b.substring(1, 4)) {\n                return Number(a[4]) - Number(b[4]);\n            }\n            switch (a.substring(1, 4)) {\n                case \"sun\":\n                    return -1;\n                case \"mon\":\n                    if (b.substring(1, 4) == \"sun\") return 1;\n                    return -1;\n                case \"tue\":\n                    if (b.substring(1, 4) == \"sun\" || b.substring(1, 4) == \"mon\") return 1\n                    return -1;\n                case \"wed\":\n                    if (b.substring(1, 4) == \"sun\" || b.substring(1, 4) == \"mon\" || b.substring(1, 4) == \"tue\") return 1\n                    return -1;\n                case \"thu\":\n                    if (b.substring(1, 4) == \"sun\" || b.substring(1, 4) == \"mon\" || b.substring(1, 4) == \"tue\" || b.substring(1, 4) == \"wed\") return 1\n                    return -1;\n                case \"fri\":\n                    if (b.substring(1, 4) == \"sun\" || b.substring(1, 4) == \"mon\" || b.substring(1, 4) == \"tue\" || b.substring(1, 4) == \"wed\" || b.substring(1, 4) == \"thu\") return 1\n                    return -1;\n                case \"sat\":\n                    return 1;\n            }\n        }\n        return Number(a[0]) - Number(b[0]);\n    });\n    let n = orderedKeys.indexOf(eventToShow) - 1;\n    if (n >= 0) {\n        eventToShow = orderedKeys[n];\n        showEvent();\n    } else {\n        disable(document.getElementById('btnPriorEve'));\n    }\n};\ndocument.getElementById('btnNextEve').onclick = () => {\n    let orderedKeys = Object.keys(docDat.events).slice().sort((a, b) => {\n        if (Number(a[0]) == Number(b[0])) {\n            if (a.substring(1, 4) == b.substring(1, 4)) {\n                return Number(a[4]) - Number(b[4]);\n            }\n            switch (a.substring(1, 4)) {\n                case \"sun\":\n                    return -1;\n                case \"mon\":\n                    if (b.substring(1, 4) == \"sun\") return 1;\n                    return -1;\n                case \"tue\":\n                    if (b.substring(1, 4) == \"sun\" || b.substring(1, 4) == \"mon\") return 1\n                    return -1;\n                case \"wed\":\n                    if (b.substring(1, 4) == \"sun\" || b.substring(1, 4) == \"mon\" || b.substring(1, 4) == \"tue\") return 1\n                    return -1;\n                case \"thu\":\n                    if (b.substring(1, 4) == \"sun\" || b.substring(1, 4) == \"mon\" || b.substring(1, 4) == \"tue\" || b.substring(1, 4) == \"wed\") return 1\n                    return -1;\n                case \"fri\":\n                    if (b.substring(1, 4) == \"sun\" || b.substring(1, 4) == \"mon\" || b.substring(1, 4) == \"tue\" || b.substring(1, 4) == \"wed\" || b.substring(1, 4) == \"thu\") return 1\n                    return -1;\n                case \"sat\":\n                    return 1;\n            }\n        }\n        return Number(a[0]) - Number(b[0]);\n    });\n    let n = orderedKeys.indexOf(eventToShow) + 1;\n    if (n < orderedKeys.length) {\n        eventToShow = orderedKeys[n];\n        showEvent();\n    } else {\n        disable(document.getElementById('btnNextEve'));\n    }\n};\n\nfunction render() {\n    document.getElementById('weeksCont').innerHTML = \"\";\n    docDat.weeks.forEach((week, wIdx) => {\n        let weekRow = document.createElement('tr');\n        weekRow.style.height = '10rem';\n        document.getElementById('weeksCont').appendChild(weekRow);\n        for (let i = 0; i < 7; i++) {\n            let day = week[daysOfWeek[i]]\n            let dayCell = document.createElement('td');\n            classes(dayCell, \"p-0\");\n            weekRow.appendChild(dayCell);\n            if (day) {\n                let num = document.createElement('p');\n                classes(num, \"m-0 p-1\");\n                num.style.fontSize = 'x-large';\n                num.innerHTML = '<b>' + day.date + '</b>';\n                dayCell.appendChild(num);\n\n                let events = document.createElement('div');\n                classes(events, \"autoOverflow\");\n                events.style.maxHeight = '7rem';\n                day.events.forEach((event, idx) => {\n                    let btnEvent = document.createElement('button');\n                    btnEvent.setAttribute(\"data-toggle\", \"modal\");\n                    btnEvent.setAttribute(\"data-target\", \"#mdlEventInfo\");\n                    classes(btnEvent, \"btn text-left p-1 mb-1 w-100\");\n                    btnEvent.style.backgroundColor = \"#c3e6cb\";\n                    btnEvent.style.borderColor = \"#8fd19e\";\n                    btnEvent.innerHTML = '<small>' + event.name + '</small>';\n                    btnEvent.onclick = () => {\n                        eventToShow = wIdx + daysOfWeek[i] + idx;\n                        showEvent();\n                    }\n                    events.appendChild(btnEvent);\n                });\n                let btnPlusEvent = document.createElement('button');\n                classes(btnPlusEvent, \"btn btn-scckie btn-block btn-sm\");\n                btnPlusEvent.innerHTML = '<i class=\"fas fa-plus\"></i>';\n                btnPlusEvent.onclick = () => {\n                    docDat.events[wIdx + daysOfWeek[i] + day.events.length] = {\n                        date: longDay[i] + \" \" + day.date + \" de \" + fullMonth(docId % 100),\n                        name: \"Evento sin nombre\",\n                        description: \"Sin descripción\",\n                        visibilidad: \"Visible a simple vista\",\n                        horario: [\"Ciudad de México:\", \"Bogotá:\", \"Madrid:\"]\n                    };\n                    day.events.push({\n                        name: \"Evento sin nombre\"\n                    });\n                    normSave();\n                }\n                events.appendChild(btnPlusEvent);\n                dayCell.appendChild(events);\n            }\n        }\n    });\n    document.getElementById('eventInfoCont').innerHTML = \"\";\n    for (const [key, event] of Object.entries(docDat.events)) {\n        let changed = false;\n        let form = document.createElement('div');\n        form.id = key;\n        classes(form, \"d-none overflow-auto\");\n        let bod = document.createElement('div');\n        classes(bod, \"modal-body\");\n        form.appendChild(bod);\n\n        let fsec = document.createElement('div');\n        classes(fsec, \"d-none\");\n        bod.appendChild(fsec);\n        let fg0 = document.createElement('div');\n        classes(fg0, \"form-group\");\n        fsec.appendChild(fg0);\n        fg0.innerHTML = '<label>Nombre del evento</label>';\n        let in0 = document.createElement('input');\n        in0.id = \"inEveTitle\" + key;\n        in0.setAttribute(\"type\", \"text\");\n        classes(in0, \"form-control\");\n        fg0.appendChild(in0);\n        let fg1 = document.createElement('div');\n        classes(fg1, \"form-group\");\n        fsec.appendChild(fg1);\n        fg1.innerHTML = '<label>Descripción</label>';\n        let in1 = document.createElement('textarea');\n        classes(in1, \"form-control\");\n        in1.id = \"inEveDesc\" + key;\n        in1.setAttribute(\"rows\", \"3\");\n        fg1.appendChild(in1);\n        let fg2 = document.createElement('div');\n        classes(fg2, \"form-group\");\n        fsec.appendChild(fg2);\n        fg2.innerHTML = '<label>Visiblidad</label>';\n        let in2 = document.createElement('select');\n        in2.id = \"inVis\" + key;\n        classes(in2, \"form-control\");\n        let visOpts = [\"Visible a simple vista\", \"Visible con binoculares\", \"Visible con un telescopio pequeño\", \"Visible con un telescopio de 4 pulgadas\", \"Visible con un telescopio grande\", \"No observable\"]\n        visOpts.forEach((itm, idx) => {\n            let opt = document.createElement('option');\n            opt.value = idx;\n            opt.innerHTML = itm;\n            if (itm == event.visibilidad) opt.setAttribute('selected', \"true\");\n            in2.appendChild(opt);\n        });\n        fg2.appendChild(in2);\n        let fg3 = document.createElement('div');\n        classes(fg3, \"form-group\");\n        fsec.appendChild(fg3);\n        fg3.innerHTML = '<label>Horario</label>';\n        let in3 = document.createElement('textarea');\n        classes(in3, \"form-control\");\n        in3.id = \"inTime\" + key;\n        in3.setAttribute(\"rows\", \"4\");\n        fg3.appendChild(in3);\n        if (in2.value == 5) hideEl(fg3);\n        else showEl(fg3);\n        in0.oninput = () => {\n            enable(reverBtn);\n            changed = true;\n        };\n        in1.oninput = () => {\n            enable(reverBtn);\n            changed = true;\n        };\n        in2.oninput = () => {\n            enable(reverBtn);\n            changed = true;\n            if (in2.value == 5) hideEl(fg3);\n            else showEl(fg3);\n        };\n        in3.oninput = () => {\n            enable(reverBtn);\n            changed = true;\n        };\n\n        let selLangCC = document.createElement('div');\n        classes(selLangCC, \"row\");\n        let selLangC = document.createElement('div');\n        classes(selLangC, \"col-auto\");\n        selLangCC.appendChild(selLangC);\n        let selLang = document.createElement('select');\n        classes(selLang, \"form-control ml-auto h-100\");\n        selLang.setAttribute(\"name\", \"selTransLang\");\n        selLangC.appendChild(selLang);\n        let btnTrans = document.createElement('button');\n        classes(btnTrans, 'btn btn-scckie mx-2');\n        btnTrans.innerHTML = '<i class=\"fas fa-language\"></i>';\n        btnTrans.onclick = function () {//@#Aqui\n            db.collection('calendar/langs/' + selLang.value).doc(docId).get().then(async function (doc) {\n                let sect = doc.data().events[key];\n                if (!sect) return;\n                if (sect.type == 'head') {\n                    docDat.cont[idx].title = await translateSimple(sect.title, selLang.value, lang);\n                } else if (sect.type == 'html') {\n                    docDat.cont[idx].html = await translateSimple(sect.html, selLang.value, lang);\n                } else if (sect.type == 'parra') {\n                    docDat.cont[idx].text = await translateSimple(sect.text, selLang.value, lang);\n                    if (sect.title != \"0\") {\n                        docDat.cont[idx].titleTxt = await translateSimple(sect.titleTxt, selLang.value, lang);\n                    }\n                } else if (sect.type == 'medSimple') {\n                    docDat.cont[idx].alt = await translateSimple(sect.alt, selLang.value, lang);\n                    docDat.cont[idx].caption = await translateSimple(sect.caption, selLang.value, lang);\n                }\n                console.log(docDat.cont[idx]);\n                normSave();\n            }).catch(err => console.log(err));\n        }\n        selLangCC.appendChild(btnTrans);\n        fsec.appendChild(selLangCC);\n\n        let tsec = document.createElement('div');\n        bod.appendChild(tsec);\n        let eveTit = document.createElement('h3');\n        eveTit.innerHTML = event.name;\n        tsec.appendChild(eveTit);\n        let eveDesc = document.createElement('p');\n        eveDesc.innerHTML = event.description;\n        tsec.appendChild(eveDesc);\n        let eveVis = document.createElement('p');\n        eveVis.innerHTML = \"Visibilidad: \" + event.visibilidad;\n        tsec.appendChild(eveVis);\n        let eveTime = document.createElement('p');\n        classes(eveTime, \"mb-0\");\n        eveTime.innerHTML = \"Horario: \";\n        tsec.appendChild(eveTime);\n        let eveTimeLst = document.createElement('ul');\n        tsec.appendChild(eveTimeLst);\n        event.horario.forEach(time => {\n            let li = document.createElement('li');\n            li.innerHTML = time;\n            eveTimeLst.appendChild(li);\n        });\n        if (event.visibilidad == \"No observable\") {\n            hideEl(eveTime);\n            hideEl(eveTimeLst);\n        }\n        else {\n            showEl(eveTime);\n            showEl(eveTimeLst);\n        }\n\n\n        let foot = document.createElement('div');\n        classes(foot, \"modal-footer\");\n        form.appendChild(foot);\n\n        let delBtn = document.createElement('button');\n        classes(delBtn, \"btn btn-danger mr-auto\")\n        delBtn.setAttribute(\"type\", \"button\");\n        delBtn.innerText = \"Borrar\";\n        delBtn.onclick = () => {\n            for (let i = Number(key.substr(4)) + 1; i < docDat.weeks[Number(key[0])][key.substr(1, 3)].events.length; i++) {\n                docDat.events[key.substr(0, 4) + (i - 1)] = docDat.events[key.substr(0, 4) + i]\n            }\n            delete docDat.events[key.substr(0, 4) + (docDat.weeks[Number(key[0])][key.substr(1, 3)].events.length - 1)];\n            docDat.weeks[Number(key[0])][key.substr(1, 3)].events.splice(Number(key.substr(4)), 1);\n            $('#mdlEventInfo').modal('hide');\n            eventToShow = null;\n            normSave();\n        };\n        foot.appendChild(delBtn);\n        let editBtn = document.createElement('button');\n        classes(editBtn, \"btn btn-info\");\n        editBtn.setAttribute(\"type\", \"button\");\n        editBtn.innerText = \"Editar\";\n        editBtn.onclick = () => {\n            in0.value = event.name;\n            in1.innerHTML = event.description;\n            in2.value = visOpts.indexOf(event.visibilidad);\n            if (in2.value == 5) hideEl(fg3);\n            else showEl(fg3);\n            in3.innerHTML = \"\";\n            event.horario.forEach(time => {\n                in3.innerHTML += time + \"\\n\";\n            });\n            hideEl(tsec);\n            showEl(fsec);\n            showEl(reverBtn);\n            showEl(saveBtn);\n            enable(saveBtn);\n            hideEl(editBtn);\n        };\n        foot.appendChild(editBtn);\n        let reverBtn = document.createElement('button');\n        classes(reverBtn, \"btn btn-secondary mr-1 d-none\");\n        reverBtn.setAttribute(\"type\", \"button\");\n        disable(reverBtn);\n        reverBtn.innerText = \"Revertir\";\n        reverBtn.onclick = () => {\n            changed = false;\n            disable(reverBtn);\n            in0.value = event.name;\n            in1.innerHTML = event.description;\n            in2.value = visOpts.indexOf(event.visibilidad);\n            if (in2.value == 5) hideEl(fg3);\n            else showEl(fg3);\n            in3.innerHTML = \"\";\n            event.horario.forEach(time => {\n                in3.innerHTML += time.trim() + \"\\n\";\n            });\n        };\n        foot.appendChild(reverBtn);\n        let saveBtn = document.createElement('button');\n        classes(saveBtn, \"btn btn-scckie d-none\");\n        saveBtn.setAttribute(\"type\", \"button\");\n        disable(saveBtn);\n        saveBtn.innerText = \"Guardar\";\n        saveBtn.onclick = () => {\n            disable(reverBtn);\n            disable(saveBtn);\n            if (changed) {\n                docDat.weeks[Number(key[0])][key.substr(1, 3)].events[key[4]].name = event.name = in0.value;\n                event.description = in1.value.trim();\n                event.visibilidad = visOpts[in2.value];\n                event.horario = [];\n                in3.value.trim().split('\\n').forEach(time => {\n                    if (time != \"\" && time != \" \") event.horario.push(time);\n                });\n                normSave();\n            } else {\n                hideEl(fsec);\n                showEl(tsec);\n                hideEl(reverBtn);\n                hideEl(saveBtn);\n                showEl(editBtn);\n            }\n        };\n        foot.appendChild(saveBtn);\n\n        document.getElementById('eventInfoCont').appendChild(form);\n    }\n\n    document.getElementsByName('selTransLang').forEach(itm => {\n        itm.innerHTML='';\n    });\n    langs.forEach((l, i) => {\n        if (l != lang) {\n            let opt = document.createElement('option');\n            if (i == 0) {\n                opt.setAttribute('selected', 'true');\n            }\n            opt.value = opt.innerText = l;\n            document.getElementsByName('selTransLang').forEach(itm => {\n                itm.appendChild(opt.cloneNode(true));\n            });\n        }\n    });\n}\n\n\nfunction resetChgImg(uncheck) {\n    document.getElementById('prevMed').src = docDat.picUrl;\n    if (uncheck) {\n        document.getElementById('inMedSrc0').checked = false;\n        document.getElementById('inMedSrc1').checked = false;\n    }\n    document.getElementById('inChgImg').value = \"\";\n    document.getElementById('inChgImgUrl').value = \"\";\n    document.getElementById('inChgImg').removeAttribute('required');\n    document.getElementById('inChgImgUrl').removeAttribute('required');\n    hideEl(document.getElementById(\"barChgImgCont\"));\n    hideEl(document.getElementById(\"inChgImgFileCont\"));\n    hideEl(document.getElementById(\"inChgImgUrlCont\"));\n    document.getElementById(\"btnCnfChgImg\").removeAttribute('disabled');\n    document.getElementById(\"btnCanChgImg\").removeAttribute('disabled');\n}\ndocument.getElementById('btnChgImg').onclick = () => {\n    resetChgImg(true);\n    toggleEl(document.getElementById(\"frmChgImg\"));\n};\ndocument.getElementById('inChgImg').addEventListener('change', e => {\n    newMedia = e.target.files[0];\n    function prevMed() {\n        var read = new FileReader();\n        read.readAsDataURL(newMedia);\n        read.onload = function (e2) {\n            document.getElementById(\"prevMed\").src = e2.target.result;\n        };\n    };\n    newMedia.name = ultraClean(newMedia.name, '');\n    document.getElementById('inChgImgL').innerHTML = newMedia.name;\n    prevMed(newMedia);\n});\ndocument.getElementById('inChgImgUrl').onchange = function () {\n    document.getElementById(\"prevMed\").src = document.getElementById('inChgImgUrl').value;\n};\ndocument.getElementById('inMedSrc0').onclick = function () {\n    newMedSrc = \"home\";\n    resetChgImg(false);\n    document.getElementById('inChgImg').setAttribute('required', 'true');\n    showEl(document.getElementById(\"inChgImgFileCont\"));\n}\ndocument.getElementById('inMedSrc1').onclick = function () {\n    newMedSrc = \"out\";\n    resetChgImg(false);\n    document.getElementById('inChgImgUrl').setAttribute('required', 'true');\n    showEl(document.getElementById(\"inChgImgUrlCont\"));\n}\n\ndocument.getElementById('btnPrevCal').onclick = function () {\n    docDat.timePrev = new firebase.firestore.Timestamp.fromMillis((new Date(Date.now())).getTime() + 900000);\n    normSave();\n};\ndocument.getElementById('btnPrevMail').onclick = function () {\n    docDat.timePrev = new firebase.firestore.Timestamp.fromMillis((new Date(Date.now())).getTime() + 900000);\n    normSave();\n};\n\nfunction validateRevision() {\n    let revLangs = 0;\n    langs.forEach(l => {\n        let rev = docDat.revised[l] ? docDat.revised[l].length : 0;\n        if (docDat.revised[l] && !docDat.revised[l].includes(uid)) rev++;\n        if (rev >= 2) revLangs++;\n    });\n    return revLangs == langs.length;\n}\n\ndocument.getElementById('btnAprove').onclick = function () {\n    if (docDat.revised[lang] && docDat.revised[lang].includes(uid)) {\n        docDat.revised[lang].splice(docDat.revised[lang].indexOf(uid), 1);\n        document.getElementById('btnAprove').innerHTML = '<i class=\"far fa-check-square\"></i>';\n    } else {\n        if (!docDat.revised[lang]) docDat.revised[lang] = [];\n        docDat.revised[lang].push(uid);\n        document.getElementById('btnAprove').innerHTML = '<i class=\"fas fa-check-square\"></i>';\n    }\n    if (validateRevision()) {\n        docDat.finished = true;\n        newCal();\n    } else {\n        docDat.finished = false;\n    }\n    normSave();\n};\n\nfunction newCal() {\n    let nextCalID;\n    rtDb.ref('nextCal').transaction(nCal => {\n        if (nCal) {\n            nextCalID = nCal;\n            nCal++;\n            if (nCal % 100 == 13) {\n                nCal -= 12;\n                nCal += 100;\n            }\n        }\n        return nCal;\n    }, (error) => {\n        if (error) {\n            console.log(error);\n        } else {\n            let date = new Date((nextCalID - nextCalID % 100) / 100 + ' ' + nextCalID % 100 + ' ' + '00:00');\n            let weeks = [];\n            let days;\n            if (date.getMonth() == 1) {\n                if (date.getFullYear() % 4 == 0) {\n                    days = 29;\n                } else {\n                    days = 28;\n                }\n            } else if (date.getMonth() % 2 == 0) {\n                if (date.getMonth() <= 6) days = 31;\n                else days = 30;\n            } else {\n                if (date.getMonth() <= 6) days = 30;\n                else days = 31;\n            }\n            let bDay = date.getDay();\n            for (let i = 1; i <= days; i = i) {\n                let week = {};\n                for (let j = bDay; j < daysOfWeek.length; j++) {\n                    if (i > days) break;\n                    week[daysOfWeek[j]] = {\n                        date: i,\n                        events: []\n                    }\n                    i++;\n                }\n                weeks.push(week);\n                bDay = 0;\n            }\n            const promises = [];\n            langs.forEach(l => {\n                if (l != lang) {\n                    let newC = {\n                        events: {},\n                        published: firebase.firestore.Timestamp.fromDate(date),\n                        description: \"\",\n                        descriptionShort: \"\",\n                        finished: false,\n                        pastDue: false,\n                        picUrl: \"\",\n                        picAlt: \"\",\n                        picCapt: \"\",\n                        public: false,\n                        sentMail: false,\n                        revised: {},\n                        title: \"\",\n                        url: \"\",\n                        nextCal: \"\",\n                        priorCal: \"\",\n                        weeks: weeks,\n                        translations: {}\n                    }\n\n                    let intId = parseInt(nextCalID);\n                    let year = (intId - intId % 100) / 100;\n                    let nYear = (intId - intId % 100) / 100;\n                    let pYear = (intId - intId % 100) / 100;\n                    if (intId % 100 == 12) nYear++;\n                    if (intId % 100 == 1) pYear--;\n                    let month = fullMonth(intId % 100);\n                    let nMonth = fullMonth(intId % 100 + 1).toLowerCase();\n                    let pMonth = fullMonth(intId % 100 - 1).toLowerCase();\n                    let calsText = \"\";\n                    switch (l) {\n                        case \"es\":\n                            calsText = \"calendario-astronomico\";\n                            newC.title = \"Calendario Astronómico de \" + month + \" \" + year;\n                            break;\n                        case \"en\":\n                            calsText = \"astronomic-calendar\";\n                            newC.title = \"Astronomic Calendar of \" + month + \" \" + year;\n                            break;\n                    }\n                    newC.url = \"https://sciencecookies.net/\" + calsText + \"/\" + year + \"/\" + month.toLowerCase() + \"/\";\n                    newC.nextCal = \"https://sciencecookies.net/\" + calsText + \"/\" + nYear + \"/\" + nMonth + \"/\";\n                    newC.priorCal = \"https://sciencecookies.net/\" + calsText + \"/\" + pYear + \"/\" + pMonth + \"/\";\n\n                    promises.push(db.collection('calendars/langs/' + l).doc(Math.abs(nextCalID).toString()).set(newC));\n                }\n            })\n            return Promise.all(promises).then(() => {\n                console.log('exito');\n            }).catch(err => console.log(err));\n        }\n    });\n}\n\n$('#mdlPublish').on('show.bs.modal', e => {\n    if (validateRevision()) {\n        showEl(document.getElementById('btnCnfPublish'));\n        document.getElementById('mdlPublishTxt').innerText = \"El calendario está listo para publicar\";\n    } else {\n        hideEl(document.getElementById('btnCnfPublish'));\n        document.getElementById('mdlPublishTxt').innerText = \"Para publicar es necesario que lo hayan aprovado al menos dos personas.\";\n    }\n});\n\ndocument.getElementById('btnCnfPublish').onclick = function () {\n    if (docDat.public) return;\n    setprog(document.getElementById('barPublish'), 0);\n    showEl(document.getElementById('barPublishCont'));\n\n    docDat.public = true;\n    setprog(document.getElementById('barPublish'), 25);\n\n    saveDoc().then(() => {\n        setprog(document.getElementById('barPublish'), 58);\n        admin.database().ref('calendarios/' + docId).set({\n            pop: 0\n        }, err => {\n            if (err) {\n                if (lang = \"es\") {\n                    alertTop(\"<strong>¡Ha ocurrido un error!</strong> \" + err.code, 0);\n                } else if (lang = \"en\") {\n                    alertTop(\"<strong>¡There has been an error!</strong> \" + err.code, 0);\n                }\n                console.log(err);\n            } else {\n                setprog(document.getElementById('barPublish'), 100);\n                classes(document.getElementById('barPublish'), 'bg-success');\n                if (lang = \"es\") {\n                    alertTop(\"Publicado correctamente\", 1);\n                } else if (lang = \"en\") {\n                    alertTop(\"Published successfully\", 1);\n                }\n                setTimeout(function () {\n                    window.open(docDat.url, '_blank').focus();\n                }, 2500);\n                $('#mdlPublish').modal('hide');\n                console.log('Published ' + docId + ' calendar');\n                return null;\n            }\n        });\n    }).catch(err => {\n        if (lang = \"es\") {\n            alertTop(\"<strong>¡Ha ocurrido un error!</strong> \" + err.code, 0);\n        } else if (lang = \"en\") {\n            alertTop(\"<strong>¡There has been an error!</strong> \" + err.code, 0);\n        }\n        console.log(err);\n    });\n};"]}
{"version":3,"sources":["js/editCal.js"],"names":["docDat","docId","savedInterval","store","firebase","storage","rtDb","database","lastSave","Date","now","saved","newMedia","newMedSrc","eventToShow","daysOfWeek","longDay","fullMonth","n","saveDoc","db","console","log","collection","doc","update","normSave","then","showEvent","clearInterval","setInterval","minutes","Math","floor","document","getElementById","innerText","catch","err","code","setprog","bar","setAttribute","style","width","Object","keys","events","forEach","key","hideEl","innerHTML","date","showEl","enable","render","weeks","week","wIdx","weekRow","createElement","height","appendChild","i","day","dayCell","classes","num","fontSize","maxHeight","event","idx","btnEvent","backgroundColor","borderColor","name","onclick","btnPlusEvent","length","description","visibilidad","horario","push","changed","form","id","bod","fsec","fg0","in0","fg1","in1","fg2","in2","visOpts","itm","opt","value","fg3","in3","oninput","reverBtn","tsec","eveTit","eveDesc","eveVis","eveTime","eveTimeLst","time","li","foot","delBtn","Number","substr","splice","$","modal","editBtn","indexOf","saveBtn","disable","trim","split","entries","resetChgImg","uncheck","src","picUrl","checked","removeAttribute","newCal","nextCalID","ref","transaction","nCal","error","month","days","getMonth","getFullYear","bDay","getDay","j","nYear","pYear","nMonth","toLowerCase","pMonth","abs","toString","set","firestore","Timestamp","fromDate","descriptionShort","finished","pastDue","picAlt","picCapt","public","sentMail","revised","title","url","nextCal","priorCal","window","loaded","urlSrch","get","onSnapshot","exists","data","includes","uid","href","replace","location","addEventListener","preventDefault","addMed","put","on","snap","bytesTransferred","totalBytes","setTimeout","click","getDownloadURL","medUrl","picDesc","picDescShort","orderedKeys","slice","sort","a","b","substring","toggleEl","e","prevMed","read","target","files","ultraClean","FileReader","readAsDataURL","onload","e2","result","onchange","timePrev","fromMillis","getTime","rev","admin","calID","pop","open","focus"],"mappings":"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","file":"editCal.1dc50c9d.js","sourceRoot":"../src","sourcesContent":["import '../styles/editCal.scss';\n\nvar store = firebase.storage();\nvar rtDb = firebase.database();\n\nlet docDat, docId;\nlet lastSave = Date.now(), saved = false;\n\nlet newMedia = null;\nlet newMedSrc = null;\n\nlet eventToShow = null;\n\nconst daysOfWeek = ['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat'], longDay = ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sabado'];\nfunction fullMonth(n) {\n    switch (n) {\n        case 1:\n            return \"Enero\";\n        case 2:\n            return \"Febrero\";\n        case 3:\n            return \"Marzo\";\n        case 4:\n            return \"Abril\";\n        case 5:\n            return \"Mayo\";\n        case 6:\n            return \"Junio\";\n        case 7:\n            return \"Julio\";\n        case 8:\n            return \"Agosto\";\n        case 9:\n            return \"Septiembre\";\n        case 10:\n            return \"Octubre\";\n        case 11:\n            return \"Noviembre\";\n        case 12:\n            return \"Diciembre\";\n        case 0:\n            return \"Diciembre\";\n        case 13:\n            return \"Enero\";\n    }\n}\n\nwindow.loaded = function loaded() {\n    db.collection('calendarios').doc(urlSrch.get('file')).onSnapshot(doc => {\n        if (!doc.exists) {\n            window.location.href = '../404';\n            return;\n        }\n        docDat = doc.data();\n        docId = doc.id;\n        document.getElementById('title').innerHTML = docDat.title;\n        document.getElementById('prevMed').src = docDat.picUrl;\n        document.getElementById('inPicCapt').value = docDat.picCapt;\n        document.getElementById('inPicAlt').value = docDat.picAlt;\n        document.getElementById('inDesc').value = docDat.description;\n        document.getElementById('inDescShort').value = docDat.descriptionShort;\n        render();\n        if (docDat.public) {\n            hideEl(document.getElementById('btnAprove'));\n            hideEl(document.getElementById('btnPub'));\n        } else {\n            showEl(document.getElementById('btnAprove'));\n            if (docDat.pastDue) showEl(document.getElementById('btnPub'));\n        }\n        if (docDat.revised.includes(uid)) {\n            document.getElementById('btnAprove').innerHTML = '<i class=\"fas fa-check-square\"></i>';\n        } else {\n            document.getElementById('btnAprove').innerHTML = '<i class=\"far fa-check-square\"></i>';\n        }\n        document.getElementById('btnPrevCal').href = docDat.url.replace(\"https://sciencecookies.net\",\"localhost:5000\");\n        document.getElementById('btnPrevMail').href = '/vista-email-calendario/' + docId;\n        document.getElementById('btnSrcCal').href = `https://in-the-sky.org/newscal.php?month=${urlSrch.get('file').substr(5, 6)}&year=${urlSrch.get('file').substr(0, 4)}&maxdiff=7&country=1484&reg1=3527646&reg2=8379372&town=3530597`;\n        document.getElementById('btnSrcCal2').href = `https://in-the-sky.org/newscal.php?month=${urlSrch.get('file').substr(5, 6)}&year=${urlSrch.get('file').substr(0, 4)}&maxdiff=7&country=1484&reg1=3527646&reg2=8379372&town=3530597`;\n        document.getElementById('btnSrcCal3').href = `https://in-the-sky.org/newscal.php?month=${urlSrch.get('file').substr(5, 6)}&year=${urlSrch.get('file').substr(0, 4)}&maxdiff=7&country=1484&reg1=3527646&reg2=8379372&town=3530597`;\n    }, err => console.log(err))\n\n    function descFrm() {\n        docDat.description = document.getElementById('inDesc').value.trim();\n        docDat.descriptionShort = document.getElementById('inDescShort').value.trim();\n        normSave();\n    }\n    document.getElementById(\"frmText\").addEventListener(\"submit\", function (event) {\n        event.preventDefault();\n        descFrm();\n    });\n\n    function addMed() {\n        let ref = store.ref('calendarMedia/' + docId + '/pic');\n        ref.put(newMedia).on('state_changed',\n            function progress(snap) {\n                setprog(document.getElementById('barChgImg'), Math.floor((snap.bytesTransferred / snap.totalBytes) * 100));\n            },\n            function error(err) {\n                document.getElementById(\"alrtClsSsn\").innerHTML = '<div id=\"alrtClsSsnAlrt\" class=\"alert alert-warning alert-dismissible fade show fixed-bottom\" role=\"alert\"><strong>¡Ocurrió un error!</strong> ' + err.code + '<button id=\"btnAlrtClsSsn\" type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button></div>';\n                setTimeout(function () {\n                    if (document.getElementById(\"btnAlrtClsSsn\")) document.getElementById(\"btnAlrtClsSsn\").click();\n                }, 3000);\n                console.log(err);\n                $('#mdlAddMed').modal('hide');\n            },\n            function complete() {\n                ref.getDownloadURL().then(medUrl => {\n                    docDat.picUrl = medUrl;\n                    normSave();\n                    resetChgImg(true);\n                    hideEl(document.getElementById(\"frmChgImg\"));\n                }).catch(err => { console.log(err) });\n            }\n        );\n    }\n    function addExtMed() {\n        docDat.picUrl = document.getElementById('inChgImgUrl').value;\n        normSave();\n        resetChgImg(true);\n        hideEl(document.getElementById(\"frmChgImg\"));\n    }\n    document.getElementById(\"frmChgImg\").addEventListener(\"submit\", function (event) {\n        event.preventDefault();\n        setprog(document.getElementById('barChgImg'), \"0\");\n        showEl(document.getElementById(\"barChgImgCont\"));\n        hideEl(document.getElementById(\"frmChgImg\"));\n        document.getElementById(\"btnCnfChgImg\").setAttribute('disabled', 'true');\n        document.getElementById(\"btnCanChgImg\").setAttribute('disabled', 'true');\n        if (newMedSrc == \"home\") addMed();\n        else addExtMed();\n    });\n}\n\ndocument.getElementById('inPicCapt').oninput = () => {\n    docDat.picCapt = document.getElementById('inPicCapt').value.trim();\n}\ndocument.getElementById('inPicAlt').oninput = () => {\n    docDat.picAlt = document.getElementById('inPicAlt').value.trim();\n}\ndocument.getElementById('inDesc').oninput = () => {\n    docDat.picDesc = document.getElementById('inDesc').value.trim();\n}\ndocument.getElementById('inDescShort').oninput = () => {\n    docDat.picDescShort = document.getElementById('inDescShort').value.trim();\n}\n\nlet savedInterval;\nfunction saveDoc() {\n    console.log('Saving...');\n    return db.collection('calendarios').doc(docId).update(docDat);\n}\nfunction normSave() {\n    saveDoc().then(() => {\n        if (eventToShow) showEvent();//IMPORTANT\n        if (saved) clearInterval(savedInterval);\n        saved = true;\n        savedInterval = setInterval(() => {\n            let minutes = Math.floor((Date.now() - lastSave) / 60000);\n            if (minutes < 60) document.getElementById('tagLstSave').innerText = \"Guardado hace \" + minutes + \" minutos\";\n            else document.getElementById('tagLstSave').innerText = \"Guardado hace \" + Math.floor(minutes / 60) + \" horas\";\n        }, 300010);\n        document.getElementById('tagLstSave').innerText = \"Se han guardado los cambios\";\n        lastSave = Date.now();\n    }).catch(err => {\n        document.getElementById('tagLstSave').innerText = \"Error, no se han guardado todos los cambios: \" + err.code;\n        console.log(err);\n    });\n}\n\nfunction setprog(bar, n) {\n    bar.setAttribute('aria-valuenow', n);\n    bar.style.width = n + '%';\n    bar.innerText = n + '%';\n}\n\nfunction showEvent() {\n    Object.keys(docDat.events).forEach(key => {\n        hideEl(document.getElementById(key));\n    });\n    document.getElementById('mdlEventInfoL').innerHTML = docDat.events[eventToShow].date;\n    showEl(document.getElementById(eventToShow));\n    enable(document.getElementById('btnPriorEve'));\n    enable(document.getElementById('btnNextEve'));\n}\ndocument.getElementById('btnPriorEve').onclick = () => {\n    let orderedKeys = Object.keys(docDat.events).slice().sort((a, b) => {\n        if (Number(a[0]) == Number(b[0])) {\n            if (a.substring(1, 4) == b.substring(1, 4)) {\n                return Number(a[4]) - Number(b[4]);\n            }\n            switch (a.substring(1, 4)) {\n                case \"sun\":\n                    return -1;\n                case \"mon\":\n                    if (b.substring(1, 4) == \"sun\") return 1;\n                    return -1;\n                case \"tue\":\n                    if (b.substring(1, 4) == \"sun\" || b.substring(1, 4) == \"mon\") return 1\n                    return -1;\n                case \"wed\":\n                    if (b.substring(1, 4) == \"sun\" || b.substring(1, 4) == \"mon\" || b.substring(1, 4) == \"tue\") return 1\n                    return -1;\n                case \"thu\":\n                    if (b.substring(1, 4) == \"sun\" || b.substring(1, 4) == \"mon\" || b.substring(1, 4) == \"tue\" || b.substring(1, 4) == \"wed\") return 1\n                    return -1;\n                case \"fri\":\n                    if (b.substring(1, 4) == \"sun\" || b.substring(1, 4) == \"mon\" || b.substring(1, 4) == \"tue\" || b.substring(1, 4) == \"wed\" || b.substring(1, 4) == \"thu\") return 1\n                    return -1;\n                case \"sat\":\n                    return 1;\n            }\n        }\n        return Number(a[0]) - Number(b[0]);\n    });\n    let n = orderedKeys.indexOf(eventToShow) - 1;\n    if (n >= 0) {\n        eventToShow = orderedKeys[n];\n        showEvent();\n    } else {\n        disable(document.getElementById('btnPriorEve'));\n    }\n};\ndocument.getElementById('btnNextEve').onclick = () => {\n    let orderedKeys = Object.keys(docDat.events).slice().sort((a, b) => {\n        if (Number(a[0]) == Number(b[0])) {\n            if (a.substring(1, 4) == b.substring(1, 4)) {\n                return Number(a[4]) - Number(b[4]);\n            }\n            switch (a.substring(1, 4)) {\n                case \"sun\":\n                    return -1;\n                case \"mon\":\n                    if (b.substring(1, 4) == \"sun\") return 1;\n                    return -1;\n                case \"tue\":\n                    if (b.substring(1, 4) == \"sun\" || b.substring(1, 4) == \"mon\") return 1\n                    return -1;\n                case \"wed\":\n                    if (b.substring(1, 4) == \"sun\" || b.substring(1, 4) == \"mon\" || b.substring(1, 4) == \"tue\") return 1\n                    return -1;\n                case \"thu\":\n                    if (b.substring(1, 4) == \"sun\" || b.substring(1, 4) == \"mon\" || b.substring(1, 4) == \"tue\" || b.substring(1, 4) == \"wed\") return 1\n                    return -1;\n                case \"fri\":\n                    if (b.substring(1, 4) == \"sun\" || b.substring(1, 4) == \"mon\" || b.substring(1, 4) == \"tue\" || b.substring(1, 4) == \"wed\" || b.substring(1, 4) == \"thu\") return 1\n                    return -1;\n                case \"sat\":\n                    return 1;\n            }\n        }\n        return Number(a[0]) - Number(b[0]);\n    });\n    let n = orderedKeys.indexOf(eventToShow) + 1;\n    if (n < orderedKeys.length) {\n        eventToShow = orderedKeys[n];\n        showEvent();\n    } else {\n        disable(document.getElementById('btnNextEve'));\n    }\n};\n\nfunction render() {\n    document.getElementById('weeksCont').innerHTML = \"\";\n    docDat.weeks.forEach((week, wIdx) => {\n        let weekRow = document.createElement('tr');\n        weekRow.style.height = '10rem';\n        document.getElementById('weeksCont').appendChild(weekRow);\n        for (let i = 0; i < 7; i++) {\n            let day = week[daysOfWeek[i]]\n            let dayCell = document.createElement('td');\n            classes(dayCell, \"p-0\");\n            weekRow.appendChild(dayCell);\n            if (day) {\n                let num = document.createElement('p');\n                classes(num, \"m-0 p-1\");\n                num.style.fontSize = 'x-large';\n                num.innerHTML = '<b>' + day.date + '</b>';\n                dayCell.appendChild(num);\n\n                let events = document.createElement('div');\n                classes(events, \"autoOverflow\");\n                events.style.maxHeight = '7rem';\n                day.events.forEach((event, idx) => {\n                    let btnEvent = document.createElement('button');\n                    btnEvent.setAttribute(\"data-toggle\", \"modal\");\n                    btnEvent.setAttribute(\"data-target\", \"#mdlEventInfo\");\n                    classes(btnEvent, \"btn text-left p-1 mb-1 w-100\");\n                    btnEvent.style.backgroundColor = \"#c3e6cb\";\n                    btnEvent.style.borderColor = \"#8fd19e\";\n                    btnEvent.innerHTML = '<small>' + event.name + '</small>';\n                    btnEvent.onclick = () => {\n                        eventToShow = wIdx + daysOfWeek[i] + idx;\n                        showEvent();\n                    }\n                    events.appendChild(btnEvent);\n                });\n                let btnPlusEvent = document.createElement('button');\n                classes(btnPlusEvent, \"btn btn-scckie btn-block btn-sm\");\n                btnPlusEvent.innerHTML = '<i class=\"fas fa-plus\"></i>';\n                btnPlusEvent.onclick = () => {\n                    docDat.events[wIdx + daysOfWeek[i] + day.events.length] = {\n                        date: longDay[i] + \" \" + day.date + \" de \" + fullMonth(docId % 100),\n                        name: \"Evento sin nombre\",\n                        description: \"Sin descripción\",\n                        visibilidad: \"Visible a simple vista\",\n                        horario: [\"Ciudad de México:\", \"Bogotá:\", \"Madrid:\"]\n                    };\n                    day.events.push({\n                        name: \"Evento sin nombre\"\n                    });\n                    normSave();\n                }\n                events.appendChild(btnPlusEvent);\n                dayCell.appendChild(events);\n            }\n        }\n    });\n    document.getElementById('eventInfoCont').innerHTML = \"\";\n    for (const [key, event] of Object.entries(docDat.events)) {\n        let changed = false;\n        let form = document.createElement('div');\n        form.id = key;\n        classes(form, \"d-none overflow-auto\");\n        let bod = document.createElement('div');\n        classes(bod, \"modal-body\");\n        form.appendChild(bod);\n\n        let fsec = document.createElement('div');\n        classes(fsec, \"d-none\");\n        bod.appendChild(fsec);\n        let fg0 = document.createElement('div');\n        classes(fg0, \"form-group\");\n        fsec.appendChild(fg0);\n        fg0.innerHTML = '<label>Nombre del evento</label>';\n        let in0 = document.createElement('input');\n        in0.id = \"inEveTitle\" + key;\n        in0.setAttribute(\"type\", \"text\");\n        classes(in0, \"form-control\");\n        fg0.appendChild(in0);\n        let fg1 = document.createElement('div');\n        classes(fg1, \"form-group\");\n        fsec.appendChild(fg1);\n        fg1.innerHTML = '<label>Descripción</label>';\n        let in1 = document.createElement('textarea');\n        classes(in1, \"form-control\");\n        in1.id = \"inEveDesc\" + key;\n        in1.setAttribute(\"rows\", \"3\");\n        fg1.appendChild(in1);\n        let fg2 = document.createElement('div');\n        classes(fg2, \"form-group\");\n        fsec.appendChild(fg2);\n        fg2.innerHTML = '<label>Visiblidad</label>';\n        let in2 = document.createElement('select');\n        in2.id = \"inVis\" + key;\n        classes(in2, \"form-control\");\n        let visOpts = [\"Visible a simple vista\", \"Visible con binoculares\", \"Visible con un telescopio pequeño\", \"Visible con un telescopio de 4 pulgadas\", \"Visible con un telescopio grande\", \"No observable\"]\n        visOpts.forEach((itm, idx) => {\n            let opt = document.createElement('option');\n            opt.value = idx;\n            opt.innerHTML = itm;\n            if (itm == event.visibilidad) opt.setAttribute('selected', \"true\");\n            in2.appendChild(opt);\n        });\n        fg2.appendChild(in2);\n        let fg3 = document.createElement('div');\n        classes(fg3, \"form-group\");\n        fsec.appendChild(fg3);\n        fg3.innerHTML = '<label>Horario</label>';\n        let in3 = document.createElement('textarea');\n        classes(in3, \"form-control\");\n        in3.id = \"inTime\" + key;\n        in3.setAttribute(\"rows\", \"4\");\n        fg3.appendChild(in3);\n        if (in2.value == 5) hideEl(fg3);\n        else showEl(fg3);\n        in0.oninput = () => {\n            enable(reverBtn);\n            changed = true;\n        };\n        in1.oninput = () => {\n            enable(reverBtn);\n            changed = true;\n        };\n        in2.oninput = () => {\n            enable(reverBtn);\n            changed = true;\n            if (in2.value == 5) hideEl(fg3);\n            else showEl(fg3);\n        };\n        in3.oninput = () => {\n            enable(reverBtn);\n            changed = true;\n        };\n\n        let tsec = document.createElement('div');\n        bod.appendChild(tsec);\n        let eveTit = document.createElement('h3');\n        eveTit.innerHTML = event.name;\n        tsec.appendChild(eveTit);\n        let eveDesc = document.createElement('p');\n        eveDesc.innerHTML = event.description;\n        tsec.appendChild(eveDesc);\n        let eveVis = document.createElement('p');\n        eveVis.innerHTML = \"Visibilidad: \" + event.visibilidad;\n        tsec.appendChild(eveVis);\n        let eveTime = document.createElement('p');\n        classes(eveTime, \"mb-0\");\n        eveTime.innerHTML = \"Horario: \";\n        tsec.appendChild(eveTime);\n        let eveTimeLst = document.createElement('ul');\n        tsec.appendChild(eveTimeLst);\n        event.horario.forEach(time => {\n            let li = document.createElement('li');\n            li.innerHTML = time;\n            eveTimeLst.appendChild(li);\n        });\n        if (event.visibilidad == \"No observable\") {\n            hideEl(eveTime);\n            hideEl(eveTimeLst);\n        }\n        else {\n            showEl(eveTime);\n            showEl(eveTimeLst);\n        }\n\n\n        let foot = document.createElement('div');\n        classes(foot, \"modal-footer\");\n        form.appendChild(foot);\n\n        let delBtn = document.createElement('button');\n        classes(delBtn, \"btn btn-danger mr-auto\")\n        delBtn.setAttribute(\"type\", \"button\");\n        delBtn.innerText = \"Borrar\";\n        delBtn.onclick = () => {\n            for (let i = Number(key.substr(4)) + 1; i < docDat.weeks[Number(key[0])][key.substr(1, 3)].events.length; i++) {\n                docDat.events[key.substr(0, 4) + (i - 1)] = docDat.events[key.substr(0, 4) + i]\n            }\n            delete docDat.events[key.substr(0, 4) + (docDat.weeks[Number(key[0])][key.substr(1, 3)].events.length - 1)];\n            docDat.weeks[Number(key[0])][key.substr(1, 3)].events.splice(Number(key.substr(4)), 1);\n            $('#mdlEventInfo').modal('hide');\n            eventToShow = null;\n            normSave();\n        };\n        foot.appendChild(delBtn);\n        let editBtn = document.createElement('button');\n        classes(editBtn, \"btn btn-info\");\n        editBtn.setAttribute(\"type\", \"button\");\n        editBtn.innerText = \"Editar\";\n        editBtn.onclick = () => {\n            in0.value = event.name;\n            in1.innerHTML = event.description;\n            in2.value = visOpts.indexOf(event.visibilidad);\n            if (in2.value == 5) hideEl(fg3);\n            else showEl(fg3);\n            in3.innerHTML = \"\";\n            event.horario.forEach(time => {\n                in3.innerHTML += time + \"\\n\";\n            });\n            hideEl(tsec);\n            showEl(fsec);\n            showEl(reverBtn);\n            showEl(saveBtn);\n            enable(saveBtn);\n            hideEl(editBtn);\n        };\n        foot.appendChild(editBtn);\n        let reverBtn = document.createElement('button');\n        classes(reverBtn, \"btn btn-secondary mr-1 d-none\");\n        reverBtn.setAttribute(\"type\", \"button\");\n        disable(reverBtn);\n        reverBtn.innerText = \"Revertir\";\n        reverBtn.onclick = () => {\n            changed = false;\n            disable(reverBtn);\n            in0.value = event.name;\n            in1.innerHTML = event.description;\n            in2.value = visOpts.indexOf(event.visibilidad);\n            if (in2.value == 5) hideEl(fg3);\n            else showEl(fg3);\n            in3.innerHTML = \"\";\n            event.horario.forEach(time => {\n                in3.innerHTML += time.trim() + \"\\n\";\n            });\n        };\n        foot.appendChild(reverBtn);\n        let saveBtn = document.createElement('button');\n        classes(saveBtn, \"btn btn-scckie d-none\");\n        saveBtn.setAttribute(\"type\", \"button\");\n        disable(saveBtn);\n        saveBtn.innerText = \"Guardar\";\n        saveBtn.onclick = () => {\n            disable(reverBtn);\n            disable(saveBtn);\n            if (changed) {\n                docDat.weeks[Number(key[0])][key.substr(1, 3)].events[key[4]].name = event.name = in0.value;\n                event.description = in1.value.trim();\n                event.visibilidad = visOpts[in2.value];\n                event.horario = [];\n                in3.value.trim().split('\\n').forEach(time => {\n                    if (time != \"\" && time != \" \") event.horario.push(time);\n                });\n                normSave();\n            } else {\n                hideEl(fsec);\n                showEl(tsec);\n                hideEl(reverBtn);\n                hideEl(saveBtn);\n                showEl(editBtn);\n            }\n        };\n        foot.appendChild(saveBtn);\n\n        document.getElementById('eventInfoCont').appendChild(form);\n    }\n}\n\n\nfunction resetChgImg(uncheck) {\n    document.getElementById('prevMed').src = docDat.picUrl;\n    if (uncheck) {\n        document.getElementById('inMedSrc0').checked = false;\n        document.getElementById('inMedSrc1').checked = false;\n    }\n    document.getElementById('inChgImg').value = \"\";\n    document.getElementById('inChgImgUrl').value = \"\";\n    document.getElementById('inChgImg').removeAttribute('required');\n    document.getElementById('inChgImgUrl').removeAttribute('required');\n    hideEl(document.getElementById(\"barChgImgCont\"));\n    hideEl(document.getElementById(\"inChgImgFileCont\"));\n    hideEl(document.getElementById(\"inChgImgUrlCont\"));\n    document.getElementById(\"btnCnfChgImg\").removeAttribute('disabled');\n    document.getElementById(\"btnCanChgImg\").removeAttribute('disabled');\n}\ndocument.getElementById('btnChgImg').onclick = () => {\n    resetChgImg(true);\n    toggleEl(document.getElementById(\"frmChgImg\"));\n};\ndocument.getElementById('inChgImg').addEventListener('change', e => {\n    newMedia = e.target.files[0];\n    function prevMed() {\n        var read = new FileReader();\n        read.readAsDataURL(newMedia);\n        read.onload = function (e2) {\n            document.getElementById(\"prevMed\").src = e2.target.result;\n        };\n    };\n    newMedia.name = ultraClean(newMedia.name, '');\n    document.getElementById('inChgImgL').innerHTML = newMedia.name;\n    prevMed(newMedia);\n});\ndocument.getElementById('inChgImgUrl').onchange = function () {\n    document.getElementById(\"prevMed\").src = document.getElementById('inChgImgUrl').value;\n};\ndocument.getElementById('inMedSrc0').onclick = function () {\n    newMedSrc = \"home\";\n    resetChgImg(false);\n    document.getElementById('inChgImg').setAttribute('required', 'true');\n    showEl(document.getElementById(\"inChgImgFileCont\"));\n}\ndocument.getElementById('inMedSrc1').onclick = function () {\n    newMedSrc = \"out\";\n    resetChgImg(false);\n    document.getElementById('inChgImgUrl').setAttribute('required', 'true');\n    showEl(document.getElementById(\"inChgImgUrlCont\"));\n}\n\ndocument.getElementById('btnPrevCal').onclick = function () {\n    docDat.timePrev = new firebase.firestore.Timestamp.fromMillis((new Date(Date.now())).getTime() + 900000);\n    normSave();\n};\ndocument.getElementById('btnPrevMail').onclick = function () {\n    docDat.timePrev = new firebase.firestore.Timestamp.fromMillis((new Date(Date.now())).getTime() + 900000);\n    normSave();\n};\n\ndocument.getElementById('btnAprove').onclick = function () {\n    if (docDat.revised.includes(uid)) {\n        docDat.revised.splice(docDat.revised.indexOf(uid), 1);\n        docDat.finished = false;\n        document.getElementById('btnAprove').innerHTML = '<i class=\"far fa-check-square\"></i>';\n    } else {\n        docDat.revised.push(uid);\n        document.getElementById('btnAprove').innerHTML = '<i class=\"fas fa-check-square\"></i>';\n        if (docDat.revised.length > 1) {\n            docDat.finished = true;\n            newCal();\n        }\n    }\n    normSave();\n};\n\nfunction newCal() {\n    let nextCalID;\n    rtDb.ref('nextCal').transaction(nCal => {\n        if (nCal) {\n            nextCalID = nCal;\n            nCal++;\n            if (nCal % 100 == 13) {\n                nCal -= 12;\n                nCal += 100;\n            }\n        }\n        return nCal;\n    }, (error) => {\n        if (error) {\n            console.log(error);\n        } else {\n            let month = fullMonth(nextCalID % 100);\n            let date = new Date((nextCalID - nextCalID % 100) / 100 + ' ' + nextCalID % 100 + ' ' + '00:00');\n            let weeks = [];\n            let days;\n            if (date.getMonth() == 1) {\n                if (date.getFullYear() % 4 == 0) {\n                    days = 29;\n                } else {\n                    days = 28;\n                }\n            } else if (date.getMonth() % 2 == 0) {\n                if (date.getMonth() <= 6) days = 31;\n                else days = 30;\n            } else {\n                if (date.getMonth() <= 6) days = 30;\n                else days = 31;\n            }\n            let bDay = date.getDay();\n            for (let i = 1; i <= days; i = i) {\n                let week = {};\n                for (let j = bDay; j < daysOfWeek.length; j++) {\n                    if (i > days) break;\n                    week[daysOfWeek[j]] = {\n                        date: i,\n                        events: []\n                    }\n                    i++;\n                }\n                weeks.push(week);\n                bDay = 0;\n            }\n            let nYear = (nextCalID - nextCalID % 100) / 100;\n            let pYear = (nextCalID - nextCalID % 100) / 100;\n            if (nextCalID % 100 == 12) nYear++;\n            if (nextCalID % 100 == 1) pYear--;\n            let nMonth = fullMonth(nextCalID % 100 + 1).toLowerCase();\n            let pMonth = fullMonth(nextCalID % 100 - 1).toLowerCase();\n            db.collection('calendarios').doc(Math.abs(nextCalID).toString()).set({\n                events: {},\n                date: firebase.firestore.Timestamp.fromDate(date),\n                description: \"Sin descripción\",\n                descriptionShort: \"Sin descripción\",\n                finished: false,\n                pastDue: false,\n                picUrl: \"\",\n                picAlt: \"\",\n                picCapt: \"\",\n                public: false,\n                sentMail: false,\n                revised: [],\n                title: \"Calendario Astronómico de \" + month + \" \" + (nextCalID - nextCalID % 100) / 100,\n                url: \"https://sciencecookies.net/calendario-astronomico/\" + (nextCalID - nextCalID % 100) / 100 + \"/\" + month.toLowerCase(),\n                nextCal: \"https://sciencecookies.net/calendario-astronomico/\" + nYear + \"/\" + nMonth,\n                priorCal: \"https://sciencecookies.net/calendario-astronomico/\" + pYear + \"/\" + pMonth,\n                weeks: weeks\n            }).then(() => {\n                console.log('nuevo calendario');\n            }).catch(err => console.log(err));\n        }\n    });\n}\n\n$('#mdlPublish').on('show.bs.modal', e => {\n    let rev = docDat.revised.length;\n    if (!docDat.revised.includes(uid)) rev++;\n    if (rev < 2) {\n        hideEl(document.getElementById('btnCnfPublish'));\n        document.getElementById('mdlPublishTxt').innerText = \"Para publicar es necesario que lo hayan aprovado al menos dos personas.\";\n    } else {\n        showEl(document.getElementById('btnCnfPublish'));\n        document.getElementById('mdlPublishTxt').innerText = \"El calendario está listo para publicar\";\n    }\n});\n\ndocument.getElementById('btnCnfPublish').onclick = function () {\n    if (docDat.public) return;\n    setprog(document.getElementById('barPublish'), '0');\n    showEl(document.getElementById('barPublishCont'));\n    setprog(document.getElementById('barPublish'), '25');\n    db.collection('calendarios').doc(docId).update({\n        public: true\n    }).then(() => {\n        setprog(document.getElementById('barPublish'), '63');\n        admin.database().ref('calendarios/' + calID).set({\n            pop: 0\n        }, err => {\n            if (err) {\n                document.getElementById(\"alrtClsSsn\").innerHTML = '<div id=\"alrtClsSsnAlrt\" class=\"alert alert-danger alert-dismissible fade show fixed-bottom\" role=\"alert\"><strong>!Ha ocurrido un error! </strong>' + err + '<button id=\"btnAlrtClsSsn\" type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button></div>';\n                console.log(err);\n                setTimeout(function () {\n                    document.getElementById(\"btnAlrtClsSsn\").click();\n                }, 3000);\n                $('#alrtClsSsnAlrt').on('closed.bs.alert', function () {\n                    document.getElementById(\"alrtClsSsn\").innerHTML = '';\n                });\n            } else {\n                setprog(document.getElementById('barPublish'), '100');\n                classes(document.getElementById('barPublish'), 'bg-success');\n                document.getElementById(\"alrtClsSsn\").innerHTML = '<div id=\"alrtClsSsnAlrt\" class=\"alert alert-success alert-dismissible fade show fixed-bottom\" role=\"alert\">Publicado correctamente<strong></strong>                                                                           <button id=\"btnAlrtClsSsn\" type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button></div>';\n                setTimeout(function () {\n                    window.open(docDat.url, '_blank').focus();\n                }, 2500);\n                console.log(\"Published successfully.\");\n                setTimeout(function () {\n                    document.getElementById(\"btnAlrtClsSsn\").click();\n                }, 3000);\n                $('#alrtClsSsnAlrt').on('closed.bs.alert', function () {\n                    document.getElementById(\"alrtClsSsn\").innerHTML = '';\n                });\n                $('#mdlPublish').modal('hide');\n                console.log('Published ' + calID + ' calendar');\n                return null;\n            }\n        });\n    }).catch(error => {\n        document.getElementById(\"alrtClsSsn\").innerHTML = '<div id=\"alrtClsSsnAlrt\" class=\"alert alert-danger alert-dismissible fade show fixed-bottom\" role=\"alert\"><strong>!Ha ocurrido un error! </strong>' + error + '<button id=\"btnAlrtClsSsn\" type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button></div>';\n        console.log(error);\n        setTimeout(function () {\n            document.getElementById(\"btnAlrtClsSsn\").click();\n        }, 3000);\n        $('#alrtClsSsnAlrt').on('closed.bs.alert', function () {\n            document.getElementById(\"alrtClsSsn\").innerHTML = '';\n        });\n    });\n};"]}